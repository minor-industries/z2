<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rower</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="/rtgraph/dygraph.css"/>
    <link rel="stylesheet" type="text/css" href="/rtgraph/rtgraph.css"/>

    <link rel="stylesheet" type="text/css" href="/rtgraph/purecss/base-min.css">
    <link rel="stylesheet" type="text/css" href="/rtgraph/purecss/pure-min.css">
    <link rel="stylesheet" type="text/css" href="/rtgraph/purecss/grids-responsive-min.css">

    <script type="text/javascript" src="/rtgraph/dygraph.min.js"></script>
    <script type="text/javascript" src="/rtgraph/msgpack.min.js"></script>

    <link rel="stylesheet" type="text/css" href="/static/bumper-control.css">

    <script type="module">
        import {Graph} from '/rtgraph/rtgraph.js';

        document.addEventListener("DOMContentLoaded", () => {
            const second = 1000;
            const minute = second * 60;
            const seriesOpts = {
                y2: {strokeWidth: 1.0},
                y3: {strokeWidth: 1.0, color: "red"},
                y4: {strokeWidth: 1.0, color: "red"},
            }

            new Graph(document.getElementById("graphdiv0"), {
                seriesNames: [
                    "rower_avg_power_short",
                    "rower_power | mygate rower_target_power rower_max_drift_pct",
                    "rower_power_min",
                    "rower_power_max",
                ],
                title: "Power: {value}",
                ylabel: "power (watts)",
                windowSize: minute,
                height: 250,
                series: seriesOpts,
                maxGapMs: 5 * second
            });

            new Graph(document.getElementById("graphdiv1"), {
                seriesNames: [
                    "rower_spm | gt 5 | avg 30s triangle",
                    "rower_spm"
                ],
                title: "SPM: {value}",
                ylabel: "spm",
                windowSize: minute,
                height: 250,
                series: seriesOpts,
                maxGapMs: 5 * second
            });

            new Graph(document.getElementById("graphdiv2"), {
                seriesNames: [
                    "rower_stroke_count"
                ],
                title: "Stroke Count: {value}",
                windowSize: minute,
                height: 250,
                maxGapMs: 5 * second
            });

            new Graph(document.getElementById("graphdiv3"), {
                seriesNames: [
                    "rower_avg_power_long",
                ],
                title: "Avg Power: {value}",
                ylabel: "power (watts)",
                windowSize: 15 * minute,
                height: 250,
                // valueRange: [110.0, 140.0],
                maxGapMs: 5 * second
            });

            new Graph(document.getElementById("graphdiv4"), {
                seriesNames: [
                    "heartrate | gt 0 | avg 2m triangle",
                    "heartrate | gt 0"
                ],
                title: "Heartrate: {value}",
                ylabel: "bpm",
                windowSize: 15 * minute,
                height: 250,
                series: seriesOpts,
                maxGapMs: 5 * second
            });
        });
    </script>
</head>
<body>

<div id="controls-container" class="pure-g">
    <!-- bumper controls will be added here -->
</div>

<script type="module">
    import BumperControl from './bumper-control.js';

    document.addEventListener("DOMContentLoaded", () => {
        new BumperControl('controls-container', 'Target Power', 'rower_target_power', 1, 0);
        new BumperControl('controls-container', 'Max Drift %', 'rower_max_drift_pct', 0.5, 1);
        new BumperControl('controls-container', 'Max Error %', 'rower_allowed_error_pct', 0.25, 2);
    });
</script>

<div class="pure-g">
    <div class="pure-u-1 pure-u-sm-1-3">
        <div id="graphdiv0" class="rtgraph-graph"></div>
    </div>

    <div class="pure-u-1 pure-u-sm-2-3">
        <div id="graphdiv3" class="rtgraph-graph"></div>
    </div>

    <div class="pure-u-1 pure-u-sm-1-3">
        <div id="graphdiv1" class="rtgraph-graph"></div>
    </div>

    <div class="pure-u-1 pure-u-sm-2-3">
        <div id="graphdiv4" class="rtgraph-graph"></div>
    </div>

    <div class="pure-u-1 pure-u-sm-1-3">
        <div id="graphdiv2" class="rtgraph-graph"></div>
    </div>
</div>

</body>
</html>