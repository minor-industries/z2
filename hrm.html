<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bike</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="static/dygraph.css"/>
    <link rel="stylesheet" type="text/css" href="static/rtgraph.css"/>

    <link rel="stylesheet" type="text/css" href="static/purecss/base-min.css">
    <link rel="stylesheet" type="text/css" href="static/purecss/pure-min.css">
    <link rel="stylesheet" type="text/css" href="static/purecss/grids-responsive-min.css">

    <link rel="stylesheet" type="text/css" href="/static/bumper-control.css">
</head>
<body>

<script type="module" src="./startup.js"></script>

<audio id="sound-fast">
    <source src="/static/sounds/fast.mp3" type="audio/mpeg">
</audio>

<audio id="sound-slow">
    <source src="/static/sounds/slow.mp3" type="audio/mpeg">
</audio>

<audio id="sound-fairway">
    <source src="/static/sounds/fairway.mp3" type="audio/mpeg">
</audio>

<script>
    let i = 0;
    const sounds = ["sound-fairway", "sound-slow", "sound-fast"]

    function playSound() {
        i %= sounds.length;
        const audio = document.getElementById(sounds[i]);
        i++;
        audio.play();
    }
</script>

<div id="controls-container" class="pure-g">
    <div class="bumper-container pure-u-1 pure-u-md-1-2 pure-u-lg-1-3 pure-u-xl-1-4">
        <button class="pure-button pure-button-primary" style="margin: 2px;" onclick="playSound()">
            Sound
        </button>

        <button id="presetA" class="pure-button pure-button-primary" style="margin: 2px;">A</button>
        <button id="presetB" class="pure-button pure-button-primary" style="margin: 2px;">B</button>
        <button id="presetC" class="pure-button pure-button-primary" style="margin: 2px;">C</button>
        <button id="presetD" class="pure-button pure-button-primary" style="margin: 2px;">D</button>
        <span id="timerDisplay" style="margin-left: 10px; font-size: 1.5em;">00:00</span>
    </div>


</div>

<script type="module">
    import {registerPresets, setupControls} from "./static/dist/bundle.js";

    document.addEventListener("DOMContentLoaded", () => {
        const controls = setupControls('controls-container', "bike");
        registerPresets(controls, "bike");
    });
</script>


<script type="module">
    document.addEventListener("DOMContentLoaded", () => {
        const es = new EventSource('/events');

        es.onmessage = (event) => {
            console.log("event:", event.data)

            const audio = document.getElementById(`sound-${event.data}`);
            audio.play();
        };
    });
</script>


<script type="module">
    import {Graph} from './static/dist/bundle.js';
    import {runWasm} from "./startup.js";

    runWasm();

    document.addEventListener("wasmReady", () => {
        console.log("WASM is ready!");

        const second = 1000;
        const minute = second * 60;
        const seriesOpts = {
            y2: {strokeWidth: 1.0},
            y3: {strokeWidth: 1.0, color: "red"},
            y4: {strokeWidth: 1.0, color: "red"},
        }

        const g = new Graph(document.getElementById("graphdiv4"), {
            seriesNames: [
                "heartrate | gt 0 | avg 2m triangle",
                "heartrate | gt 0"
            ],
            title: "Heartrate: {value}",
            ylabel: "bpm",
            windowSize: 15 * minute,
            height: 250,
            series: seriesOpts,
            maxGapMs: 5 * second,
            connect: false,
        });

        setInterval(() => {
            g.update([{
                Pos: 0,
                Timestamps: [new Date().getTime()],
                Values: [65.0 + 2 * Math.random()],
            }]);
            createValue("test", (new Date()).getTime(), 65.5);
        }, 1000);
    });
</script>

<div class="pure-g">
    <div class="pure-u-1 pure-u-sm-2-3">
        <div id="graphdiv4" class="rtgraph-graph"></div>
    </div>
</div>


</body>
</html>

